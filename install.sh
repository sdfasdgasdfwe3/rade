#!/data/data/com.termux/files/usr/bin/bash

# =============================================
# Настройки
# =============================================
REPO_DIR="$HOME/rade"
GIT_REPO="https://github.com/ваш-username/ваш-репозиторий.git"  # Замените на URL вашего репозитория

# Зависимости Python
PYTHON_DEPS="requests telethon psutil"

# =============================================
# Функции для обработки ошибок
# =============================================
error_exit() {
    echo "ОШИБКА: $1" >&2
    exit 1
}

# =============================================
# Клонирование репозитория
# =============================================
clone_repo() {
    echo "-----------------------------------------"
    echo "Клонируем репозиторий из GitHub..."

    if [ -d "$REPO_DIR" ]; then
        echo "Директория $REPO_DIR уже существует. Пропускаем клонирование."
    else
        git clone "$GIT_REPO" "$REPO_DIR" || error_exit "Ошибка клонирования репозитория"
    fi
}

# =============================================
# Установка зависимостей Python
# =============================================
install_python_deps() {
    echo "-----------------------------------------"
    echo "Переходим в директорию $REPO_DIR..."
    cd "$REPO_DIR" || error_exit "Ошибка перехода в директорию репозитория"

    echo "Устанавливаем зависимости Python..."
    pip install --upgrade pip || error_exit "Ошибка обновления pip"
    
    for dep in $PYTHON_DEPS; do
        pip install "$dep" || error_exit "Ошибка установки зависимости: $dep"
    done
}

# =============================================
# Главный процесс выполнения
# =============================================
main() {
    # Клонируем репозиторий
    clone_repo

    # Устанавливаем зависимости
    install_python_deps

    # Выводим сообщение о том, как запустить бота
    echo "========================================="
    echo "Установка завершена."
    echo "Чтобы запустить бота, выполните команду:"
    echo "   cd $REPO_DIR && python bot.py"
    echo "========================================="
}

main
